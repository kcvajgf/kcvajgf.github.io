This integrates easily with PC^2, and this document explains how to set it up for that.

*Notes:*

- The instructions are written for Linux, but it should also work for Windows. Just update the steps accordingly.

- You will need a copy of the `scoreboard_icpc/` folder (from this repo) in all computers involved. You will also need Python 3 installed.

- Once it is running, there will be no need to refresh the browser page. It will still work even when switching PC^2 "profiles", e.g., switching from the practice contest to the main contest profile. (It will automatically clear existing scores and read the new problems/teams data.) As long as the `pc2board` account is working, it will keep working. It will also continue to work even if the `pc2board` account disconnects for some reason; you can just log in again and it will continue just fine. This works because behind the scenes, it simply reads off the `html/index.html` file generated by PC^2. Please see the "Under the hood" section below.

- If something doesn't work for you, or if you encounter problems, please tell me so I can help you fix it.

- You can add header messages, modify the title, do more customizations, etc., by modifying `scoreboard_icpc/index.html`. The scoreboard itself will be generated in the `div` with `id="leaderboard"`, so you just need to keep that `div` around.


# Using the same computer for the leaderboard account and display

1. Run `pc2board` on the `scoreboard_icpc/` folder. This tells PC^2 to generate the score HTML files under `scoreboard_icpc/html/`. You may need to place the (correctly configured) `pc2v9.ini` file in `scoreboard_icpc/` for it to run there. For example,
    
    ```bash
    cd path/to/scoreboard_icpc/
    cp path/to/pc2-9.6.0/pc2v9.ini .
    path/to/pc2-9.6.0/bin/pc2board  # runs the pc2board GUI. you now need to log in
    ```

2. On a different terminal, use `nocache_serve` (a Python 3 script) to serve `scoreboard_icpc/`.  

    ```bash
    cd path/to/scoreboard_icpc/
    ./nocache_serve
    ```

3. Open `http://localhost:8000` in a browser. It should now work.

*Notes:*

- You may need to make `nocache_serve` executable via `chmod`. (Alternatively, just use `python3 nocache_serve` or something.)

- You can specify a different port by passing it to `nocache_serve`, like `./nocache_serve 8080`.  


# Using different computers for the leaderboard account and display

1. On the leaderboard account computer, log in with a scoreboard account (anywhere), then on a different terminal, use `cors_serve` to serve the `html/` folder generated by PC^2.

    ```bash
    cd path/to/pc2-generated/html/
    path/to/cors_serve
    ```

2. On the leaderboard display computer, serve the `scoreboard_icpc/` folder:

    ```bash
    cd path/to/scoreboard_icpc/
    ./nocache_serve
    ```

3. Open `http://localhost:8000/?src=http://xx.xx.xx.xx:8000` in a browser, where `xx.xx.xx.xx` is the leaderboard account computer's IP address.

*Notes:*

- You may need to make `cors_serve` executable via `chmod`. (Alternatively, just use `python3 path/to/cors_serve` or something.)

- You can specify a different port by passing it to `cors_serve` or `nocache_serve`, like `path/to/cors_serve 8080` or `./nocache_serve 8080`.  


# Serving to the general public

For this, you will need a server with a public IP address, and another computer that has access to a `pc2board` account and can access the server via SSH.  

1. On the server, use `nocache_serve` to serve `scoreboard_icpc/`.  

    ```bash
    cd path/to/scoreboard_icpc/
    ./nocache_serve
    ```

2. On the other computer, log in with a scoreboard account (anywhere), then on a different terminal, run a script that copies the `html/index.html` file generated by PC^2 to the server's `scoreboard_icpc/html/` folder every 15 seconds or so, perhaps using `scp`, for example with a script like this:

    ```bash
    while true; do
        echo "Copying now..."
        scp local/path/to/html/index.html xxx@xx.xx.xx.xx:~/path/in/server/to/scoreboard_icpc/html/
        sleep 15
    done
    ```

    where `xxx@xx.xx.xx.xx` is the public server's IP and username. (The same argument you pass to `ssh`. You should know what this is if you are familiar with `ssh`/`scp`.)

3. The public scoreboard can now be accessed at `http://xx.xx.xx.xx:8000`, where `xx.xx.xx.xx` is the server's IP. (If your server has a domain name, say `www.example.com`, then it can be accessed at `http://www.example.com:8000`.)


*Notes:*  

- One way of doing this would be to set up a temporary SSH key for the scoreboard computer so you don't need to specify the plain password in the script. You can just delete the key afterward.

- You may need to make `nocache_serve` executable via `chmod`. (Alternatively, just use `python3 nocache_serve` or something.)

- You can specify a different port by passing it to `nocache_serve`, like `./nocache_serve 8080`. For example, you may want to use port `80` (the port assigned to HTTP) so the port doesn't have to be specified in the URL.

- Feel free to replace 15 seconds with anything you want.


# Under the hood

The thing works by reading off the `html/index.html` file produced by PC^2. Most of the setting up is just pointing it to where it can get this file.

In essence, it receives a URL param called `src` which should be a valid URL. It then fetches `/index.html` from that URL every 7 seconds or so. If the URL is not on the same domain as the one running `scoreboard_icpc/index.html`, then it needs to allow CORS (cross-origin resource sharing), otherwise, it will refuse the GET request and the scoreboard cannot read the data.

If `src` is not passed, then it defaults to `html/` (relative to the folder `scoreboard_icpc/`). As long as you can serve the files statically here and are able to update `scoreboard_icpc/html/index.html` constantly (say by copying it over every few seconds, perhaps via `scp`), the `src` param will not be needed.  

*Side comment:* since the `scoreboard_icpc/html/index.html` file is constantly changing, I think the term "static files" is not quite accurate. Oh well, I hope you get the point.


## Security and stability  

`nocache_serve` and `cors_serve` both use Python's `http.server` library to serve the files. Its [doc](https://docs.python.org/3/library/http.server.html) states that it is not production ready and also gives a security warning. This might also mean that it can't handle too many users.

I don't know how bad this really is, especially for something as simple as serving a few html, js and css files, but if you're that concerned about stability and security (maybe you have a huge audience, or your server is sensitive), then I suggest finding alternatives to `nocache_serve` and `cors_serve`. It doesn't have to be in Python. It only needs to serve a bunch of "static" files, with no-cache (otherwise, the leaderboard won't update since it will fetch a cached version every time), and in the case of `cors_serve`, it needs CORS. (Read `nocache_serve` and `cors_serve` to see the exact headers passed to `http.server`.)


